{"version":3,"sources":["components/Search.jsx","components/DlMap.jsx","components/UseCdiService.js","components/Page.jsx","components/UseDebounced.js","components/App.js","index.js"],"names":["Wrap","styled","div","InpWrap","StyledInput","input","Placeholder","span","Options","Option","GEO_BASE_URL","process","Search","selectAddress","pointAddress","cdi","useState","variants","setVariants","value","setInpValue","geoCode","cdiAddr","searchAddr","split","join","url","fetch","then","r","json","res","found","response","GeoObjectCollection","featureMember","map","item","address","GeoObject","metaDataProperty","GeocoderMetaData","text","coords","Point","pos","length","selectOption","catch","e","console","log","opt","useEffect","type","onChange","target","onKeyDown","keyCode","key","onClick","MapWrap","DlMap","entranceRef","showToast","pointRef","pointCoords","setPointCoords","entranceCoords","setEntranceCoords","showArea","setPointAddress","mapRef","setMapRef","ymaps","setYmaps","fetchAddressByCoords","defaultAddress","geolocation","get","mapStateAutoApply","result","geoObjects","position","setCenter","reverse","query","apikey","coordArr","modules","onLoad","width","height","defaultState","center","zoom","options","suppressMapOpenBlock","instanceRef","onDragend","newCoords","geometry","getCoordinates","draggable","properties","hintContent","balloonContent","ref","fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWidth","zIndex","distance","coordSystem","geo","getDistance","preset","iconColor","pointStorageVal","cashlessOnly","city","cityID","code","country_code","fullName","inPrice","isAutoCity","isTerminal","label","nameString","noSendDoor","regionString","street","uString","UseCdiService","prevSuggestions","getQuery","filteredSuggestions","filter","el","settlement_kladr_id","city_kladr_id","filteredQuery","forEach","elem","str","region_with_type","area_with_type","city_with_type","settlement_with_type","Boolean","push","lengt","pointStr","indexOf","getCityStr","sugg","street_with_type","house","house_type","block","block_type","flat","flat_type","SelectBtn","Inp","Page","set","setValue","setPrevSuggestions","cdiOptions","setCdiOptions","debouncedFetchAddress","func","delay","useRef","args","clearTimeout","current","setTimeout","UseDebouncedFunc","data","restrict_value","count","locations_boost","kladr_id","locations","method","body","JSON","stringify","mode","headers","adresses","i","kladrList","suggestions","suitable","qc","onKeyUp","Toast","App","cdiAddress","setCdiAddress","toast","setToast","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.d31ac520.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\n\nconst Wrap = styled.div`\n  width: 80%;\n  height: 64px;\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translate(-50%, 0);\n  z-index: 2;\n`;\n\nconst InpWrap = styled.div`\n  box-sizing: border-box;\n  width: 100%;\n  height: 100%;\n  border: 1px solid #D6D6D6;\n  box-shadow: 0 1px 5px rgba(0,0,0,0.1);\n  background: #ffffff;\n  border-radius: 4px;\n  overflow: hidden;\n`;\n\nconst StyledInput = styled.input`\n  box-sizing: border-box;\n  width: 100%;\n  height: 100%;\n  border: none;\n  box-shadow: none;\n  outline: none;\n  padding: 0 20px 0 180px;\n  font-size: 16px;\n  position: relative;\n  z-index: 2;\n  background: transparent;\n`;\n\nconst Placeholder = styled.span`\n  position: absolute;\n  font-weight: bold;\n  left: 10px;\n  top: 50%;\n  transform: translate(0, -50%);\n  z-index: 1;\n`;\n\nconst Options = styled.div`\n  width: 100%;\n  max-height: 200px;\n  overflow-y: auto;\n  position: absolute;\n  top: 100%;\n  background: #ffffff;\n  margin-top: 5px;\n  box-shadow: 0 1px 5px rgba(0,0,0,0.1);\n`;\n\nconst Option = styled.div`\n  padding: 5px 10px;\n  cursor: pointer;\n  font-size: 14px;\n  &:hover {\n    background: #e4e4e4;\n  }\n`;\n\nconst ENTER_KEY_CODE = 13;\nconst API_KEY_YMAPS = process.env.REACT_APP_MAP_API_KEY;\nconst GEO_BASE_URL = `https://geocode-maps.yandex.ru/1.x/?apikey=${API_KEY_YMAPS}&format=json&geocode=`;\n\nconst Search = ({ selectAddress, pointAddress, cdi }) => {\n  const [variants, setVariants] = useState([]);\n  const [value, setInpValue] = useState('');\n\n  const geoCode = (cdiAddr) => {\n    const valueAddr = cdiAddr || value;\n    const searchAddr = valueAddr.split(' ').join('+');\n    const url = `${GEO_BASE_URL}${searchAddr}`;\n\n    fetch(url)\n      .then(r => r.json())\n      .then(res => {\n        if (res) {\n          const geoObjects = res.response.GeoObjectCollection.featureMember;\n          const found = geoObjects.map(item => {\n            return {\n              address: item.GeoObject.metaDataProperty.GeocoderMetaData.text,\n              coords: item.GeoObject.Point.pos,\n            }\n          })\n\n          if (found.length === 1) {\n            selectOption(found[0]);\n          } else {\n            setVariants(found);\n          }\n        }\n      })\n      .catch(e => {\n        console.log('ERROR >>>>>>', e);\n      });\n  }\n\n  const keyPressHandler = e => {\n    const {keyCode} = e;\n    if (keyCode === ENTER_KEY_CODE) geoCode();\n  }\n\n  const changeHandler = e => {\n    setInpValue(e.target.value);\n  }\n\n  const selectOption = opt => {\n    selectAddress(opt);\n    setInpValue(opt.address);\n    setVariants([]);\n  }\n\n  useEffect(() => {\n    if (pointAddress) setInpValue(pointAddress);\n  }, [pointAddress]);\n\n\n\n\n\n\n\n\n\n  useEffect(() => {\n    if (cdi) {\n      setInpValue(cdi);\n      geoCode(cdi);\n    }\n  }, [cdi]);\n\n\n\n\n\n\n\n  \n  return (\n    <Wrap>\n      <InpWrap>\n        <StyledInput\n          type=\"text\"\n          value={value}\n          onChange={changeHandler}\n          onKeyDown={keyPressHandler}\n        />\n        <Placeholder>Адрес отправления:</Placeholder>\n      </InpWrap>\n      {\n        variants && variants.length ? (\n          <Options>\n            {variants.map(item => (\n              <Option key={item.address} onClick={() => selectOption(item)}>{item.address}</Option>\n            ))}\n          </Options>\n        ) : ''\n      }\n    </Wrap>\n  )\n}\n\nexport default Search;","import React, { useState, useEffect } from 'react';\nimport { YMaps, Map, Polygon, GeolocationControl, ZoomControl, Placemark, Circle } from 'react-yandex-maps';\nimport styled from 'styled-components';\nimport Search from './Search';\n\nconst MapWrap = styled.div`\n  overflow: hidden;\n  border-radius: 3px;\n  box-shadow: 0px 1px 10px rgba(0,0,0,0.3);\n  position: relative;\n`;\n\nconst TestBtn = styled.div`\n  font-size: 14px;\n  z-index: 2;\n  position: absolute;\n  left: 20px;\n  bottom: 20px;\n  cursor: pointer;\n  width: 200px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid #D6D6D6;\n  box-shadow: 0 1px 5px rgba(0,0,0,0.1);\n  border-radius: 3px;\n  background: #ffffff;\n  &:hover {\n    background: #f7f7f7;\n  }\n`;\n\nconst AREA_SIZE = 100;\nconst API_KEY_YMAPS = process.env.REACT_APP_MAP_API_KEY;\n\nconst DlMap = ({ cdi, showToast }) => {\n\n  let entranceRef = '';\n  let pointRef = '';\n\n  const [pointCoords, setPointCoords] = useState([]);\n  const [entranceCoords, setEntranceCoords] = useState([]);\n  const [showArea, setShowArea] = useState(false);\n  const [pointAddress, setPointAddress] = useState('');\n\n  const [mapRef, setMapRef] = useState(null);\n  const [ymaps, setYmaps] = useState(null);\n\n  const fetchAddressByCoords = (coords) => {\n    // &kind=house&results=1 - определяет адрес как ближайший дом\n    const url = `https://geocode-maps.yandex.ru/1.x/?apikey=${API_KEY_YMAPS}&format=json&geocode=${coords}&kind=house&results=1`\n  \n    fetch(url)\n      .then(r => r.json())\n      .then(res => {\n        if (res) {\n          const defaultAddress = \n            res.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;\n          setPointAddress(defaultAddress);\n        }\n      })\n      .catch(e => {\n        console.log('ERROR >>>>>>', e);\n      });\n  }\n\n  useEffect(() => {\n    if (ymaps && mapRef) {\n      ymaps.geolocation.get({\n        mapStateAutoApply: true\n      })\n      .then(function(result) {\n        if (result) {\n          const coords = result.geoObjects.position;\n          mapRef.setCenter(coords, 16);\n          setPointCoords(coords);\n\n          fetchAddressByCoords([...coords].reverse().join('+'));\n\n        }\n      });\n    }\n  }, [ymaps, mapRef])\n\n  // const SetTestCoords = () => {\n  //   const myCoords = [59.840921599999994, 30.493900800000002];\n  //   const myZoom = 16;\n\n  //   setPointCoords(myCoords);\n  //   mapRef.setCenter(myCoords, myZoom);\n  // }\n\n  const specifyEntrance = () => {\n    setShowArea(!showArea);\n    if (showArea) setEntranceCoords([]);\n  }\n\n  /*\n    сейчас эта функция работает и при клике по карте и при клике по полигону\n    потом когда будут области - надо оставить только клик по полигону и \n    если клиз вне области - тогда удалять метку!\n  */\n  const mapClick = e => {\n    // showToast();\n    if (!showArea) {\n      const coords = e.get('coords');\n\n      setPointCoords(coords);\n      fetchAddressByCoords([...coords].reverse().join('+'));\n    }\n  }\n\n  // const areaClick = e => {\n  //   if (!showArea) {\n  //     const coords = e.get('coords');\n\n  //     setPointCoords(coords);\n  //     fetchAddressByCoords([...coords].reverse().join('+'));\n  //   }\n  // }\n\n  const moveEntrance = () => {\n    const newCoords = entranceRef.geometry.getCoordinates();\n    const distance = ymaps.coordSystem.geo.getDistance(newCoords, pointCoords);\n    if (distance > AREA_SIZE) {\n      setEntranceCoords([]);\n    } else {\n      setEntranceCoords(newCoords);\n    }\n  }\n\n  const movePoint = () => {\n    const newCoords = pointRef.geometry.getCoordinates();\n    setPointCoords(newCoords);\n    fetchAddressByCoords([...newCoords].reverse().join('+'));\n  }\n\n  const circleClick = e => {\n    const coords = e.get('coords');\n    setEntranceCoords(coords);\n  }\n\n  const selectAddress = (item) => {\n    const { address, coords } = item;\n    const coordArr = coords.split(' ').reverse();\n    const zoom = 17;\n    setPointCoords(coordArr);\n    setPointAddress(address);\n    setEntranceCoords([]);\n    mapRef.setCenter(coordArr, zoom);\n  }\n\n  return (\n    <YMaps query={{ apikey: API_KEY_YMAPS }}>\n      <MapWrap>\n        {/* { \n          pointCoords && pointCoords.length \n            ? (\n              <TestBtn onClick={specifyEntrance}>\n                { entranceCoords && entranceCoords.length ? 'Скрыть область' : 'Уточнить подъезд' }\n              </TestBtn>\n            ) : ''\n        } */}\n        <Search cdi={cdi} selectAddress={selectAddress} pointAddress={pointAddress} />\n        <Map\n          modules={['geolocation', 'geocode', 'coordSystem.geo']}\n          onLoad={setYmaps}\n          onClick={mapClick}\n          width={'100%'}\n          height={'500px'}\n          defaultState={{ center: [55.75, 37.57], zoom: 12 }}\n          options={{ suppressMapOpenBlock: true }}\n          instanceRef={setMapRef}\n        >\n          <ZoomControl />\n          <GeolocationControl />\n          {\n            pointCoords && pointCoords.length ? (\n              <Placemark\n                modules={['geoObject.addon.balloon', 'geoObject.addon.hint']}\n                onDragend={movePoint}\n                geometry={pointCoords}\n                options={{ draggable: !showArea }}\n                properties={{\n                  hintContent: pointAddress,\n                  balloonContent: '<div style=\"width: 200px;\">' + pointAddress + '</div>'\n                }}\n                instanceRef={ref => (pointRef = ref)}\n              />\n            ) : ''\n          }\n          {\n            pointCoords && pointCoords.length && showArea ? (\n              <Circle\n                geometry={[pointCoords, AREA_SIZE]}\n                onClick={circleClick}\n                options={{\n                  draggable: false,\n                  fillColor: '#FFD2D2',\n                  fillOpacity: 0.4,\n                  strokeColor: '#FFD2D2',\n                  strokeOpacity: 0.7,\n                  strokeWidth: 1,\n                  zIndex: 2,\n                }}\n              />\n            ) : '' \n          }\n          {\n            entranceCoords && entranceCoords.length ? (\n              <Placemark\n                modules={['geoObject.addon.balloon', 'geoObject.addon.hint']}\n                geometry={entranceCoords}\n                onDragend={moveEntrance}\n                options={{\n                  draggable: true,\n                  preset: 'islands#dotIcon',\n                  iconColor: '#ef2c2c',\n                }}\n                properties={{\n                  hintContent: 'Подъезд',\n                  balloonContent: 'Подъезд - дополнительная информация',\n                }}\n                instanceRef={ref => (entranceRef = ref)}\n              />\n            ) : ''\n          }\n          {/* <Polygon\n            geometry={[\n              [\n                [55.73, 37.54],\n                [55.77, 37.54],\n                [55.77, 37.67],\n                [55.73, 37.66],\n              ],\n              [\n                [59.93727133539923, 30.31255582405088],\n                [59.94011379470408, 30.312341247329694],\n                [59.9406521117351, 30.319036041030863],\n                [59.93724980068361, 30.31950810981749],\n              ],\n              [\n                [59.835406433316464, 30.491914146711682],\n                [59.83938078758292, 30.47989785032497],\n                [59.845946069213966, 30.483245247175553],\n                [59.84663707591772, 30.49749314146265],\n                [59.840158322960896, 30.509166115095464],\n              ]\n            ]}\n            options={{\n              fillColor: '#23629a',\n              // strokeColor: '#000000',\n              opacity: 0.3,\n              // strokeWidth: 1,\n              zIndex: 1,\n              // strokeStyle: 'shortdash',\n            }}\n            onClick={areaClick}\n          /> */}\n        </Map>\n      </MapWrap>\n    </YMaps>\n  )\n}\n\nexport default DlMap;","// TODO: Add select city input\nconst pointStorageVal = {\n  cashlessOnly: \"0\",\n  city: \"Санкт-Петербург\",\n  cityID: 200601,\n  code: \"7800000000000000000000000\",\n  country_code: 643,\n  fullName: \"г. Санкт-Петербург\",\n  inPrice: \"1\",\n  isAutoCity: \"1\",\n  isTerminal: \"1\",\n  label: \"г. Санкт-Петербург\",\n  nameString: \"Санкт-Петербург г\",\n  noSendDoor: \"0\",\n  regionString: \"г. Санкт-Петербург\",\n  street: \"1\",\n  uString: \"\",\n  value: \"Санкт-Петербург\",\n};\n\nconst UseCdiService = (prevSuggestions, value) => {\n  const getCityStr = (sugg) => {\n    return [\n      sugg.region_with_type ? sugg.region_with_type : '',\n      sugg.area_with_type ? ', ' + sugg.area_with_type : '',\n      sugg.city_with_type ?  ', ' + sugg.city_with_type : '',\n      sugg.settlement_with_type ?  ', ' + sugg.settlement_with_type : '',\n      sugg.street_with_type ?  ', ' + sugg.street_with_type : '',\n      sugg.house ?  ', ' + sugg.house_type + ' ' + sugg.house : '',\n      sugg.block ?  ' ' + sugg.block_type + ' ' + sugg.block : '',\n      sugg.flat ?  ', ' + sugg.flat_type + ' ' + sugg.flat : ''\n    ].filter(Boolean).join('')\n  };\n\n  const getQuery = () => {\n    var filteredSuggestions = !!prevSuggestions && prevSuggestions.length\n      ? prevSuggestions.filter((el) => {\n          const locationCode =  el.settlement_kladr_id || el.city_kladr_id;\n  \n          return locationCode === pointStorageVal.code;\n        })\n      : [];\n  \n    var query = [];\n    var filteredQuery = [];\n  \n    if (prevSuggestions.length\n      && filteredSuggestions.length) {\n        prevSuggestions.forEach(function (elem) {\n          const str = [\n            elem.region_with_type ? elem.region_with_type : '',\n            elem.area_with_type ? elem.area_with_type : '',\n            elem.city_with_type ? elem.city_with_type : '',\n            elem.settlement_with_type ? elem.settlement_with_type : '',\n            value\n          ].filter(Boolean).join(' ');\n  \n          query.push(str);\n        });\n    } else if (prevSuggestions.length\n      && !filteredSuggestions.lengt) {\n        const pointStr = [\n          pointStorageVal && pointStorageVal.regionString ? pointStorageVal.regionString : '',\n          pointStorageVal && pointStorageVal.uString ? pointStorageVal.uString.split(',')[0] : '',\n          pointStorageVal && pointStorageVal.nameString ? pointStorageVal.nameString : '',\n          value\n        ].filter(Boolean).join(' ');\n  \n        query.push(pointStr);\n  \n        prevSuggestions.forEach(function (elem) {\n          var str = [\n            elem.region_with_type ? elem.region_with_type : '',\n            elem.area_with_type ? elem.area_with_type : '',\n            elem.city_with_type ? elem.city_with_type : '',\n            elem.settlement_with_type ? elem.settlement_with_type : '',\n            value\n          ].filter(Boolean).join(' ');\n  \n          query.push(str);\n        });\n\n    } else if (!prevSuggestions.length) {\n      const pointStr = [\n        pointStorageVal && pointStorageVal.regionString ? pointStorageVal.regionString : '',\n        pointStorageVal && pointStorageVal.uString ? pointStorageVal.uString.split(',')[0] : '',\n        pointStorageVal && pointStorageVal.fullName ? pointStorageVal.fullName : '',\n        value\n      ].filter(Boolean).join(' ');\n  \n      query.push(pointStr);\n    }\n  \n    query.forEach(function (el) {\n      if (filteredQuery.indexOf(el) === -1) {\n        filteredQuery.push(el);\n      }\n    })\n  \n    return filteredQuery;\n  };\n\n  return { getQuery, getCityStr };\n}\n\nexport default UseCdiService;","import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport UseDebouncedFunc from './UseDebounced';\nimport UseCdiService from './UseCdiService';\n\nconst Wrap = styled.div`\n  position: relative;\n  margin-bottom: 40px;\n  padding-right: 100px;\n`;\n\nconst SelectBtn = styled.div`\n  cursor: pointer;\n  width: 90px;\n  position: absolute;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #23629a;\n  color: #ffffff;\n  border-radius: 4px;\n  &:hover {\n    background: #2a73b5;\n  }\n`;\n\nconst Inp = styled.input`\n  box-sizing: border-box;\n  width: 100%;\n  border: 1px solid #D6D6D6;\n  box-shadow: 0 1px 5px rgba(0,0,0,0.1);\n  border-radius: 4px;\n  outline: none;\n  padding: 10px 20px;\n  font-size: 16px;\n  background: transparent;\n`;\n\nconst Options = styled.div`\n  overflow-y: auto;\n  max-height: 200px;\n  top: 100%;\n  left: 5px;\n  right: 5px;\n  background: #ffffff;\n  position: absolute;\n  z-index: 3;\n  box-shadow: 0 1px 5px rgba(0,0,0,0.1);\n  margin-top: 10px;\n  border-radius: 2px;\n`;\n\nconst Option = styled.div`\n  padding: 5px;\n  font-size: 14px;\n  cursor: pointer;\n  &:hover {\n    background: #f7f7f7;\n  }\n`;\n\nconst Page = ({ set }) => {\n  const [value, setValue] = useState('');\n  const [prevSuggestions, setPrevSuggestions] = useState('');\n  const [cdiOptions, setCdiOptions] = useState('');\n\n  const onChangeHandler = e => {\n    setValue(e.target.value);\n  }\n\n  const { getQuery, getCityStr } = UseCdiService(prevSuggestions, value); \n\n  const fetchAddress = () => {\n    const url = `https://www.dellin.stage/api/v1/address/search`;\n    const data = {\n      restrict_value: true,\n      count: 20,\n      query: value,\n      locations_boost: [{ kladr_id:\"78\" }], // ???\n      locations: [{ kladr_id:\"78\" },{ kladr_id:\"78\" },{ kladr_id:\"47\" }], // ???\n      data: getQuery()\n    };\n\n    fetch(url, {\n      method: 'POST', \n      body: JSON.stringify(data),\n      mode: 'cors',\n      headers: {\n        'Access-Control-Allow-Origin':'*',\n        'Content-Type': 'application/json;charset=utf-8',\n      }\n    })\n      .then(r => r.json())\n      .then(res => {\n        const adresses = res.data.map(i => {\n          if (!i.value) i.value = getCityStr(i);\n          return i;\n        });\n        setCdiOptions(adresses);\n\n        const kladrList = {};\n      \n        const suggestions = res.data.filter(function(el) {\n          var suitable = res.type === 'clean' ? el.qc === '0' || el.qc === '1' : true;\n          if (!kladrList[el.kladr_id] && suitable) {\n            kladrList[el.kladr_id] = true;\n            return true;\n          } else {\n            return false;\n          }\n        });\n        // if (!!searchValue && suggestions.length && type === 'suggest') this._suggestions = suggestions;\n        if (suggestions.length && res.type === 'suggest') setPrevSuggestions(suggestions);\n      })\n      .catch(e => {\n        console.log('ERROR >>>>>>', e);\n      });\n  }\n\n  const debouncedFetchAddress = UseDebouncedFunc(fetchAddress, 300);\n\n  const keyPressHandler = () => {\n    // const isSpb = true;\n    // const cityIsInRussia = true;\n    // const code = pointStorageVal.code;\n    // const cityCode = code.length === 24 ? code : `0${code}`;\n    // const noStreet = pointStorageVal.street === '0';\n\n    debouncedFetchAddress();\n  }\n\n  const selectOption = option => {\n    setValue(option.value);\n    setCdiOptions('');\n  }\n\n  const clickSelectButton = () => {\n    set(value);\n  }\n\n  useEffect(() => {\n    if (!value) setPrevSuggestions('');\n  }, [value])\n\n  return (\n    <Wrap>\n      <SelectBtn onClick={clickSelectButton}>Выбрать</SelectBtn>\n      <Inp type=\"text\" onChange={onChangeHandler} value={value} onKeyUp={keyPressHandler} />\n      {cdiOptions && (\n        <Options>\n          {cdiOptions.map(item => (\n            <Option onClick={() => selectOption(item)} key={item.kladr_id}>{item.value}</Option>\n          ))}\n        </Options>\n      )}\n    </Wrap>\n  );\n}\n\nexport default Page;","import { useRef } from 'react';\n\nexport default function useDebouncedFunction(func, delay) {\n  const ref = useRef(null);\n\n  return (...args) => {\n    clearTimeout(ref.current);\n    ref.current = setTimeout(() => func(...args), delay);\n  };\n}","import React, { useEffect, useState, useRef } from 'react';\nimport DlMap from './DlMap';\nimport Page from './Page';\nimport styled from 'styled-components';\n\nconst Wrap = styled.div`\n  width: 800px;\n  margin: 0 auto;\n  padding: 40px 10px 100px 10px;\n`;\n\nconst Toast = styled.div`\n  width: 300px;\n  padding: 10px 20px;\n  color: #ffffff;\n  border-radius: 4px;\n  box-shadow: 0px 1px 10px rgba(0,0,0,0.3);\n  position: fixed;\n  right: 30px;\n  bottom: 30px;\n  background: #e04439;\n  z-index: 100;\n  font-size: 14px;\n\n  animation: fadeIn 0.3s ease;\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      right: -100px;\n    }\n    to {\n      opacity: 1;\n      right: 30px;\n    }\n  }\n`;\n\nfunction App() {\n  const [cdiAddress, setCdiAddress] = useState('');\n  const [toast, setToast] = useState('');\n  const ref = useRef(null);\n\n\n  useEffect(() => {\n    clearTimeout(ref.current);\n    ref.current = setTimeout(() => {\n      setToast(false);\n    }, 2000);\n    return () => {\n      clearTimeout(ref.current);\n    }\n  }, [toast]);\n\n  const showToast = () => {\n    setToast(true);\n  }\n\n  return (\n    <Wrap>\n      {toast && <Toast>Невозможно осуществить доставку в эту точку. Укажите адрес доставки внутри области.</Toast>}\n      <Page set={setCdiAddress} />\n      <DlMap cdi={cdiAddress} width=\"100%\" showToast={showToast} />\n    </Wrap>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}